文档概述 : 应知应会
======
__在进一步阅读之前，确认你已经给查阅了 [软件概述页面][1] ，其介绍了本文里很多相关的名词解释。同时下面其中有一些信息你现在不需要关心，但是当你着手开发的时候，这些信息会成为你的枕边书。这些都是 Yocto 项目开发的已知最适合的工作方法，我们会不定期的更新。__

————————-

__使用 Yocto 项目非常简单，但是出现问题就不好应付了。没有理解编译过程是如何工作的，你会发现你自己在尝试排查一个“黑盒子”的故障。这边有几条给新手开始第一次用 Yocto 项目编译之前他们希望已经知道的事项。如有其他建议请随时联系我们：__

1. __使用 Git，而不是 tar 包下载。__ 
如果你用 git，软件根据 git 的运行情况将会自动更新修复问题。如果你下载 tar 包，你将需要自行更新。

2. __深入了解层索引__
所有的层可在 [层索引][2]找到。层主要应用于反映 Yocto 项目的兼容性状态（结构延续性的保证和科测试性），可以在[Yocto 项目的兼容性索引][3]中找到对应的层。一般首先需要检查兼容性索引，然后如果没有发现必要的层，去检查下通用层索引。层索引是来自嵌入式开源项目最基本的工件。因此，层索引没有专门的规划和测试而是 Yocto 项目直接提供的项目兼容性列表。但是后者有少量的条目。要知道你正在索引的层不是所有的层都有一样的成熟度，有效性或可用性。检索的时候也不会安装优先级显示。没有很简单的方法帮你挑选出最适合你的层。往往结果要反复试错，经过确认邮件列表，或和其他开发者一起协作才帮忙得到正确的选项。


3. __尽可能使用已知芯片的 BSP 层__
Intel, TI, NXP 和其他平台都有自己芯片对应的 BSP 层（layer）信息。这些层的名字都是类似于 “meta-intel” 或 “meta-ti”。不要尝试从头开始自己构建层。如果你需要对芯片定制，用现有的这些层作为指导书或模块，并熟悉 [Yocto 项目板级开发包（BSP）开发指南][4]。

4. __不要把所有的东西放到一个层__ 
使用不同的层在逻辑上分开编译信息。例如：你有一个 BSP 层，GUI 层，一个发行版配置，中间件，或一个应用程序（例如:"meta-filesystems","meta-python","meta-intel",等等）。把所有的编译到一个层将有很大的限制和很难对后续的定制和复用性进行兼容。在另一方面，将信息隔离多个层中帮助简化了后续定制和复用。

5. __永远不要修改 POKY 层__ 

永远不要，一旦你这么做了，当你升级基线到下一个版本，你会失去之前所有的工作。是的，所有工作。

6. __不要被搜索文档的结果所欺骗__
Yocto 项目文档会经常更新。不幸的是，当你用谷歌搜索 Yocto 项目概念或名词的时候，谷歌总是查找和检索 Yocto 项目的旧版本手册。比如：用谷歌在 Yocto 项目手册中搜索包含 “hit” 的指定标题的结果就是几个老版本的。确保你用最新的 Yocto 项目文档，最好在 [Yocto 项目文档页面][6]查找你软件版本对应的文档。如果你使用文档概述页面的搜索栏，这样搜索虽然不是最优的，但它会告诉你搜索的字符串在哪个文档。这样搜索会通常指出某个名词或概念的出处。


许多开发者通过检索 “Yocto 项目全文档集” 来查找 Yocto 项目手册的术语和名词。这个文档是对 Yocto 项目手册的核心集的整合。因此，用过 Ctrl-F 在这个手册搜索出所有 “hits” 的名词或术语。一旦你找到了你想要的地方，你就可以看到你想要的手册了。

7. __理解构建统如何工作的基本概念:运作流程 __ 
理解 Yocto 项目运作流程很重要，它帮你查找问题发生在哪里和编译时如何崩溃的。运作流程分以下几个步骤：

- 1） Fetch - 获取源码
- 2） Extract - 解压源码
- 3） Patch - 为解决问题和新特性打补丁
- 4） Configure - 配置您的环境的一致性
- 5） Build - 编译和链接
- 6） Instal - 拷贝文件到目标目录
- 7） Package - 打包安装文件

在 “fetch” 过程中，可能无法获取到源码。在 “extract” 中，可能存在无效的压缩包或类似的问题。另一方面，了解运作流程中特定的机制可能会让你了解出错在哪里。
![yp-how-it-works-new-diagram.png][5]

8. __需要知道的是你可以产生一个依赖图并学习如何用它__
一个依赖图展示了 recipe 任务 和 目标的依赖关系。你可以用 BitBake 的 “-g” 选项生成这样的图。当你开始编译是遇到崩溃，你对这软件包的一无所知或不知道为什么编译系统要包含他们。依赖图可以澄清这个困惑。你可以学习更多的依赖图以及如何在 BitBake 用户手册看到如何生成一个依赖图。

9. __下面是你如何解码 tmp/work 下的目录名 “magic”__
构建系统包含获取，解压，预处理以及编译。如果中间出现了错误，构建系统会直接提示正在编译的临时文件（build/tmp）和软件包的目录。若想了解其详细过程，可查看这个范例。不幸的是这个范例是 Yocto项目的早期版本。

但你执行一个构建，你可以用 BitBake 命令的 “-u” 选项来指定用户查看依赖图的工具（例如：knotty，ncurses 或 taskexp）以帮助你更好的来理解编译依赖。

10. __你不仅仅可以构建镜像__
你可以为一个特定的包（包括 devshell）甚至单个配方（recips）构建和运行一个特定的任务。开发人员第一次使用 Yocto 项目，Yocto 项目快速入手手册仅会展示如何创建一个镜像并运行和烧录它。实际是你可以只构建一个配方。因此，如果一些依赖或配方有问题，你可以只运行 “bitbak foo”，“foo” 就是指定配方（recipe）的名字。如果你已经精通使用 Yocto 项目，如果构建失败的情况下，确保它自己按照预期获取源码很有用处。这儿有一些很有价值的链接：“用一个开发壳”得到[如何用 devshell 构建和运行指定的任务][6]的信息。同时，[SDK 手册展示了如何构建出一个指定的配方（recipe）][7] 。


11. __容易混淆的定义： 包（Package）和 配方（Recipe）__
一个配方（Recipe） 包含构建系统创建包的指令集。配方（Recipe）和包（Package）的区别在于编译进程的前端和结果.

如刚才所述，构建系统加工配方（recipe）然后根据配方（recipe）的指令创建包（Package）。生成的包（package）与正在编译的配方（recipe）有关，但它是编译的不同部分（package）（例如：主包，文档包，调试的符号表包，独立的工具包，等等）。构建系统将包（package）进行了分类，不需要安装的包就没有必要安装，这在编译小型设备的时候很有用，如开发嵌入式或 IOT 设备。

12. __你会期望学习和了解 rootfs 里有哪些包（package）__

13. __创建自己的配方（recipe）__
这有很多方法创建你自己的镜像配方。我们建议创建你自己的镜像配方而不是追加一个现有的配方。创建一个镜像配方很容易。还是不要尝试追加修改一个现有的镜像配方。创建你自己的，创建自己的配方，万丈高楼平地起。

14. __最后，这有有一个基本技能列表，你作为系统开发人员将需要基本的。你必须可以：__
- 会配置网络的代理
- 会增加一个包到镜像
- 理解配方（recipe）和 包（package）的差异
- 会构建一个包（package）并知道其用处
- 找出一个配方（recipe）所创建的包（package）有哪些
- 找出一个包（package）包含哪些的文件
- 找出一个镜像的文件有哪些
- 增加一个 SSH 服务到一个镜像文件（使能转换文件到目标）
- 知道如何剖析一个配方（recipe）
- 知道如何创建和使用层（layer）
- 查找配方 （layer.openembedded.org）
- 理解硬件配置和发行版配置之间的差异
- 查找发行版特性的范例和知道如何设置它们
- 通过共享下载和共享状态缓存提升构建速度
- 生成并理解依赖图
- 生成并理解 bitbake 的配置环境
- 为应用程序构建一个可扩展的 SDK 

15. 如果您对 Yocto 项目发自内心的热爱，可考虑阅读以下内容：

__浏览 Yocto 项目开发任务手册：__ 
这个手册包含一些很有帮助的过程性信息，如进行配置和运行层，定制镜像，书写新配方（recipe），使用库文件以及使用 QEMU。这些信息是基于任务的，涵盖了 Yocto 项目的所有范围。

__浏览 Yocto 项目应用和扩展软件开发套件手册：__ 
这个手册描述如何使用标准 SDK 和 扩展SDK，这些 SDK 主要用于应用开发的。这个手册也提供了使用受欢迎的 Eclipse 开发环境和 devtool 的工作流程的范例。查看 “使用Eclipse 的工作流程” 和 “在您的 SDK 工作流程中使用 devtool ” 章节获取更多信息。

__学习内核相关开发：__ 如果你想了解如何使用内核或理解 Yocto 的 Linux 内核，查看 Yocto 项目的 Linux 内核开发手册。这个手册提供了如何给内核打补丁，修改内核配方（recipe）以及配置内核。

__关于学习板级支持包（BSPs）：__ 如果你想学习关于 BSP, 查看 Yocto 项目板级支持包开发指南。这个手册也提供了创建 BSP 的范例。查看 “开发板级支持包” 章节。

__关于学习 Toaster：__ Toaster是 Yocto 项目嵌入式开源构建系统的一种网页接口。如果你对使用这个接口创建镜像有兴趣，查看 Toaster 用户手册。

__Yocto 项目参考手册__
Yocto 项目参考手册：不像其他 Yocto 项目手册，这个手册包含大量的适合参考的范例资料而不是过程描述。你可以获取编译细节，深入了解 Yocto 项目开发环境的要素是如何一起工作的，这个要素包含大量的技术细节，移植一个新的 Yocto 项目版本的指导，还有目录结构，类和任务的参考信息。Yocto 项目参考手册同时包含一个Yocto 项目涉及的完整的术语表。

via：https://www.yoctoproject.org/docs/what-i-wish-id-known/

译者：[guevara](https://github.com/guevaraya)
校对：[校对者ID](https://github.com/校对者ID)
版权所有© Linux 基金会

[1]: https://github.com/guevaraya/Yocto_doc/blob/master/software-overview/software-overview.md
[2]: http://layers.openembedded.org/
[3]: https://github.com/guevaraya/Yocto_doc/blob/master/software-overview/layer/index.md
[4]: https://github.com/guevaraya/Yocto_doc/blob/master/2.4/bsp-guide/bsp-guide.md
[5]: https://www.yoctoproject.org/wp-content/uploads/2017/07/yp-how-it-works-new-diagram.png
[6]: https://github.com/guevaraya/Yocto_doc/blob/master/3.0/bitbake-user-manual/bitbake-user-manual.md#generating-dependency-graphs
[7]: https://github.com/guevaraya/Yocto_doc/blob/master/2.5/mega-manual/mega-manual.md#sdk-devtool-use-devtool-modify-to-modify-the-source-of-an-existing-component



